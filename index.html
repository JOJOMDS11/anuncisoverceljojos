<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JOJO AN√öNCIOS - Painel Discord</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Login Form */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-form {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-form h1 {
            color: #5865f2;
            margin-bottom: 30px;
            font-size: 2rem;
        }

        .login-form .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        /* Main Interface */
        .main-interface {
            display: none;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-content h1 {
            color: #5865f2;
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header-content p {
            color: #666;
            font-size: 1.1rem;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .stats-card {
            background: rgba(88, 101, 242, 0.1);
            border: 2px solid #5865f2;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            min-width: 120px;
        }

        .stats-number {
            font-size: 2rem;
            font-weight: bold;
            color: #5865f2;
            display: block;
        }

        .stats-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .logout-btn {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        .panel-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .panel-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .panel-section:hover {
            transform: translateY(-5px);
        }

        .panel-section h2 {
            color: #5865f2;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #444;
        }

        select, textarea, input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            font-family: inherit;
        }

        select:focus, textarea:focus, input:focus {
            outline: none;
            border-color: #5865f2;
            box-shadow: 0 0 0 3px rgba(88, 101, 242, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .char-counter {
            text-align: right;
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }

        .char-counter.warning {
            color: #ff6b35;
        }

        .char-counter.danger {
            color: #dc3545;
            font-weight: bold;
        }

        .btn {
            background: linear-gradient(135deg, #5865f2, #4752c4);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(88, 101, 242, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d, #5a6268);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #1e7e34);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
            width: auto;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
            display: inline-block;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Roles Selection */
        .roles-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .roles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .role-item {
            display: flex;
            align-items: center;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .role-item:hover {
            border-color: #5865f2;
        }

        .role-item.selected {
            border-color: #5865f2;
            background: rgba(88, 101, 242, 0.1);
        }

        .role-item.selected::after {
            content: '‚úì';
            position: absolute;
            top: 5px;
            right: 8px;
            color: #5865f2;
            font-weight: bold;
            font-size: 14px;
        }

        .role-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            flex-shrink: 0;
        }

        .role-name {
            font-weight: 500;
            font-size: 14px;
        }

        /* Image Upload Section */
        .image-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .image-upload {
            border: 2px dashed #5865f2;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .image-upload:hover {
            background: rgba(88, 101, 242, 0.05);
        }

        .image-upload.dragover {
            border-color: #4752c4;
            background: rgba(88, 101, 242, 0.1);
        }

        .image-preview {
            margin-top: 10px;
            text-align: center;
        }

        .image-preview img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .image-remove {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            margin-top: 10px;
            cursor: pointer;
            font-size: 12px;
        }

        /* Announcement Types */
        .announcement-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .announcement-type {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .announcement-type:hover {
            border-color: #5865f2;
        }

        .announcement-type.selected {
            border-color: #5865f2;
            background: rgba(88, 101, 242, 0.1);
            color: #5865f2;
        }

        .announcement-type-icon {
            font-size: 2rem;
            margin-bottom: 5px;
        }

        .announcement-type-name {
            font-weight: 600;
            font-size: 14px;
        }

        /* Emoji Picker */
        .emoji-picker {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
        }

        .emoji-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 5px;
            max-height: 120px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .emoji-btn {
            padding: 8px;
            border: none;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .emoji-btn:hover {
            background: #e9ecef;
        }

        /* Quick Actions */
        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .quick-actions button {
            width: auto;
            padding: 8px 16px;
            font-size: 14px;
        }

        /* Mentions Preview */
        .mentions-preview {
            background: rgba(88, 101, 242, 0.1);
            border: 1px solid #5865f2;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            display: none;
        }

        .mentions-preview.show {
            display: block;
        }

        .mention-tag {
            background: #5865f2;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            margin: 2px;
            display: inline-block;
        }

        /* Channel Creation Section */
        .channel-form-preview {
            background: rgba(88, 101, 242, 0.1);
            border: 1px solid #5865f2;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            display: none;
        }

        .channel-form-preview.show {
            display: block;
        }

        .channel-preview {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #5865f2;
        }

        .channel-type-indicator {
            display: inline-block;
            margin-right: 5px;
        }

        .success, .error, .info {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        @media (max-width: 1200px) {
            .panel-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .roles-grid {
                grid-template-columns: 1fr;
            }
            
            .announcement-type-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Hidden file input */
        #imageInput {
            display: none;
        }

        /* Anima√ß√µes */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
    </style>
</head>
<body>
    <!-- Tela de Login -->
    <div id="loginContainer" class="login-container">
        <div class="login-form">
            <h1>üì¢ JOJO AN√öNCIOS</h1>
            <div id="loginMessage"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="password">Senha de Administrador:</label>
                    <input type="password" id="password" placeholder="Digite a senha..." required>
                </div>
                <button type="submit" class="btn" id="loginBtn">
                    Entrar
                </button>
            </form>
        </div>
    </div>

    <!-- Interface Principal -->
    <div id="mainInterface" class="main-interface">
        <div class="container">
            <div class="header">
                <div class="header-content">
                    <h1>üéØ JOJO AN√öNCIOS</h1>
                    <p>Painel completo para gerenciar Discord - An√∫ncios, Canais & Templates</p>
                </div>
                <div class="header-actions">
                    <div class="stats-card">
                        <span class="stats-number" id="statsAnnouncements">0</span>
                        <div class="stats-label">An√∫ncios</div>
                    </div>
                    <div class="stats-card">
                        <span class="stats-number" id="statsChannels">0</span>
                        <div class="stats-label">Canais</div>
                    </div>
                    <div class="stats-card">
                        <span class="stats-number" id="statsRoles">0</span>
                        <div class="stats-label">Cargos</div>
                    </div>
                    <button class="logout-btn" onclick="logout()">üö™ Sair</button>
                </div>
            </div>

            <div class="panel-grid">
                <!-- Se√ß√£o Principal de An√∫ncios -->
                <div class="panel-section">
                    <h2>üì¢ Criar An√∫ncio</h2>
                    <div id="message"></div>
                    
                    <!-- Tipo de An√∫ncio -->
                    <div class="form-group">
                        <label>Tipo de An√∫ncio:</label>
                        <div class="announcement-type-grid">
                            <div class="announcement-type selected" data-type="anuncio">
                                <div class="announcement-type-icon">üì¢</div>
                                <div class="announcement-type-name">An√∫ncio</div>
                            </div>
                            <div class="announcement-type" data-type="novidade">
                                <div class="announcement-type-icon">‚ú®</div>
                                <div class="announcement-type-name">Novidade</div>
                            </div>
                            <div class="announcement-type" data-type="atualizacao">
                                <div class="announcement-type-icon">üîÑ</div>
                                <div class="announcement-type-name">Atualiza√ß√£o</div>
                            </div>
                            <div class="announcement-type" data-type="draft">
                                <div class="announcement-type-icon">üèÜ</div>
                                <div class="announcement-type-name">Inscri√ß√µes draft</div>
                            </div>
                            <div class="announcement-type" data-type="evento">
                                <div class="announcement-type-icon">üéâ</div>
                                <div class="announcement-type-name">Evento</div>
                            </div>
                            <div class="announcement-type" data-type="vod">
                                <div class="announcement-type-icon">üìπ</div>
                                <div class="announcement-type-name">VOD</div>
                            </div>
                            <div class="announcement-type" data-type="aviso">
                                <div class="announcement-type-icon">‚ö†Ô∏è</div>
                                <div class="announcement-type-name">Aviso</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="quick-actions">
                        <button type="button" class="btn btn-secondary btn-small" onclick="refreshChannels()">
                            üîÑ Atualizar
                        </button>
                        <button type="button" class="btn btn-secondary btn-small" onclick="previewAnnouncement()">
                            üëÅÔ∏è Visualizar
                        </button>
                        <button type="button" class="btn btn-secondary btn-small" onclick="clearForm()">
                            üóëÔ∏è Limpar
                        </button>
                    </div>
                    
                    <form id="announcementForm">
                        <div class="form-group">
                            <label for="channelSelect">Canal de Destino:</label>
                            <select id="channelSelect" required>
                                <option value="">Carregando canais...</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="templateSelect">Template (opcional):</label>
                            <select id="templateSelect">
                                <option value="">Selecione um template</option>
                            </select>
                        </div>

                        <!-- Sele√ß√£o de Cargos com MULTI-SELE√á√ÉO -->
                        <div class="roles-section">
                            <label>Cargos para Mencionar (m√∫ltipla sele√ß√£o):</label>
                            <div class="roles-grid" id="rolesGrid">
                                <div class="role-item" data-loading="true">
                                    <div class="loading-spinner"></div>
                                    Carregando cargos...
                                </div>
                            </div>
                            <div class="mentions-preview" id="mentionsPreview">
                                <label style="margin-bottom: 5px; font-size: 12px;">Men√ß√µes que ser√£o enviadas:</label>
                                <div id="mentionTags"></div>
                            </div>
                        </div>

                        <!-- Se√ß√£o de Upload de Imagem -->
                        <div class="image-section">
                            <label>Imagem (opcional):</label>
                            <div class="image-upload" id="imageUpload" onclick="document.getElementById('imageInput').click()">
                                <div>
                                    üñºÔ∏è Clique aqui ou arraste uma imagem<br>
                                    <small>Formatos: JPG, PNG, GIF, WEBP (m√°x. 8MB)</small>
                                </div>
                            </div>
                            <input type="file" id="imageInput" accept="image/*">
                            <div class="image-preview" id="imagePreview"></div>
                        </div>

                        <!-- Seletor de Emojis -->
                        <div class="emoji-picker">
                            <label>Emojis R√°pidos:</label>
                            <div class="emoji-grid">
                                <button type="button" class="emoji-btn" data-emoji="üì¢">üì¢</button>
                                <button type="button" class="emoji-btn" data-emoji="üéâ">üéâ</button>
                                <button type="button" class="emoji-btn" data-emoji="‚ö†Ô∏è">‚ö†Ô∏è</button>
                                <button type="button" class="emoji-btn" data-emoji="üî•">üî•</button>
                                <button type="button" class="emoji-btn" data-emoji="üíé">üíé</button>
                                <button type="button" class="emoji-btn" data-emoji="üéØ">üéØ</button>
                                <button type="button" class="emoji-btn" data-emoji="üöÄ">üöÄ</button>
                                <button type="button" class="emoji-btn" data-emoji="‚≠ê">‚≠ê</button>
                                <button type="button" class="emoji-btn" data-emoji="üèÜ">üèÜ</button>
                                <button type="button" class="emoji-btn" data-emoji="üö®">üö®</button>
                                <button type="button" class="emoji-btn" data-emoji="‚åö">‚åö</button>
                                <button type="button" class="emoji-btn" data-emoji="‚ú®">‚ú®</button>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="announcementText">Mensagem do An√∫ncio:</label>
                            <textarea id="announcementText" placeholder="Digite sua mensagem aqui... Use emojis para deixar mais atrativo! üòä" required maxlength="2000"></textarea>
                            <div class="char-counter" id="charCounter">0/2000 caracteres</div>
                        </div>
                        
                        <button type="submit" class="btn" id="sendBtn">
                            üì§ Enviar An√∫ncio
                        </button>
                    </form>
                </div>

                <!-- Se√ß√£o de Gerenciamento -->
                <div>
                    <!-- Cria√ß√£o de Canais -->
                    <div class="panel-section" style="margin-bottom: 20px;">
                        <h2>üì∫ Criar Canal</h2>
                        <form id="channelForm">
                            <div class="form-group">
                                <label for="channelName">Nome do Canal:</label>
                                <input type="text" id="channelName" placeholder="Ex: novo-canal" required maxlength="100">
                                <small style="color: #666; font-size: 12px;">Ser√° convertido automaticamente para formato v√°lido</small>
                                <div class="channel-form-preview" id="channelPreview">
                                    <div class="channel-preview">
                                        <span class="channel-type-indicator" id="channelTypeIcon">üí¨</span>
                                        <span id="formattedChannelName">#canal-exemplo</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="channelType">Tipo de Canal:</label>
                                <select id="channelType">
                                    <option value="text">üí¨ Texto</option>
                                    <option value="voice">üîä Voz</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="channelCategory">Categoria:</label>
                                <select id="channelCategory">
                                    <option value="">üìã Carregando categorias...</option>
                                </select>
                            </div>
                            
                            <div class="quick-actions">
                                <button type="button" class="btn btn-secondary btn-small" onclick="refreshCategories()">
                                    üîÑ Atualizar Categorias
                                </button>
                            </div>
                            
                            <button type="submit" class="btn btn-success" id="createChannelBtn">
                                ‚ú® Criar Canal
                            </button>
                        </form>
                    </div>

                    <!-- Templates -->
                    <div class="panel-section" style="margin-bottom: 20px;">
                        <h2>üìù Template R√°pido</h2>
                        <form id="templateForm">
                            <div class="form-group">
                                <label for="templateName">Nome:</label>
                                <input type="text" id="templateName" placeholder="Ex: Evento Semanal" required maxlength="100">
                            </div>
                            
                            <div class="form-group">
                                <label for="templateCategory">Categoria:</label>
                                <select id="templateCategory">
                                    <option value="Geral">Geral</option>
                                    <option value="Eventos">Eventos</option>
                                    <option value="Avisos">Avisos</option>
                                    <option value="Torneios">Torneios</option>
                                    <option value="Atualiza√ß√µes">Atualiza√ß√µes</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="templateContent">Conte√∫do:</label>
                                <textarea id="templateContent" placeholder="Conte√∫do do template..." required maxlength="2000"></textarea>
                                <div class="char-counter" id="templateCharCounter">0/2000 caracteres</div>
                            </div>
                            
                            <button type="submit" class="btn btn-secondary" id="saveTemplateBtn">
                                üíæ Salvar
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURA√á√ÉO
        const API_BASE = 'https://discord-anuncios.onrender.com/api';

        let authToken = localStorage.getItem('authToken');
        let selectedRoles = [];
        let selectedAnnouncementType = 'anuncio';
        let allRoles = [];
        let selectedImage = null;

        // Verificar autentica√ß√£o na inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            if (authToken) {
                verifyToken();
            } else {
                showLogin();
            }
            setupEventListeners();
        });

        function setupEventListeners() {
            // Seletores de tipo de an√∫ncio
            document.querySelectorAll('.announcement-type').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.announcement-type').forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedAnnouncementType = this.dataset.type;
                });
            });

            // Emojis
            document.querySelectorAll('.emoji-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    const emoji = this.dataset.emoji;
                    const textarea = document.getElementById('announcementText');
                    const start = textarea.selectionStart;
                    const end = textarea.selectionEnd;
                    const text = textarea.value;
                    textarea.value = text.substring(0, start) + emoji + text.substring(end);
                    textarea.selectionStart = textarea.selectionEnd = start + emoji.length;
                    textarea.focus();
                    updateCharCounter();
                });
            });

            // Contadores de caracteres
            document.getElementById('announcementText').addEventListener('input', updateCharCounter);
            document.getElementById('templateContent').addEventListener('input', updateTemplateCharCounter);
            
            // Preview do nome do canal
            document.getElementById('channelName').addEventListener('input', updateChannelPreview);
            document.getElementById('channelType').addEventListener('change', updateChannelPreview);
            
            // Upload de imagem
            setupImageUpload();

            // Submiss√µes de formul√°rios
            setupForms();
        }

        function setupForms() {
            // Criar canal
            document.getElementById('channelForm').addEventListener('submit', createChannel);

            // Enviar an√∫ncio
            document.getElementById('announcementForm').addEventListener('submit', sendAnnouncement);

            // Salvar template
            document.getElementById('templateForm').addEventListener('submit', saveTemplate);
        }

        // Upload/Preview de imagem
        function setupImageUpload() {
            const imageUpload = document.getElementById('imageUpload');
            const imageInput = document.getElementById('imageInput');

            imageInput.addEventListener('change', function(e) {
                handleImageSelect(e.target.files[0]);
            });

            imageUpload.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('dragover');
            });

            imageUpload.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
            });

            imageUpload.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('dragover');
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith('image/')) {
                    handleImageSelect(file);
                }
            });
        }

        function handleImageSelect(file) {
            if (!file) return;

            if (!file.type.startsWith('image/')) {
                showMessage('message', 'Por favor, selecione apenas arquivos de imagem.', 'error');
                return;
            }

            if (file.size > 8 * 1024 * 1024) {
                showMessage('message', 'Imagem muito grande. M√°ximo 8MB.', 'error');
                return;
            }

            selectedImage = file;

            const reader = new FileReader();
            reader.onload = function(e) {
                const imagePreview = document.getElementById('imagePreview');
                imagePreview.innerHTML = `
                    <img src="${e.target.result}" alt="Preview">
                    <br>
                    <button type="button" class="image-remove" onclick="removeImage()">
                        üóëÔ∏è Remover Imagem
                    </button>
                `;
            };
            reader.readAsDataURL(file);

            showMessage('message', '‚úÖ Imagem carregada com sucesso!', 'success');
        }

        function removeImage() {
            selectedImage = null;
            document.getElementById('imagePreview').innerHTML = '';
            document.getElementById('imageInput').value = '';
            showMessage('message', 'Imagem removida.', 'info');
        }

        async function verifyToken() {
            try {
                const response = await fetch(`${API_BASE}/verify`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    showMainInterface();
                    loadAllData();
                } else {
                    showLogin();
                }
            } catch (error) {
                console.error('Erro ao verificar token:', error);
                showLogin();
            }
        }

        function showLogin() {
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('mainInterface').style.display = 'none';
            localStorage.removeItem('authToken');
            authToken = null;
        }

        function showMainInterface() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('mainInterface').style.display = 'block';
        }

        // LOGIN
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<div class="loading-spinner"></div>Verificando...';
            
            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });
                
                const result = await response.json();
                
                if (response.ok && result.token) {
                    localStorage.setItem('authToken', result.token);
                    authToken = result.token;
                    showMessage('loginMessage', result.message || 'Login realizado com sucesso!', 'success');
                    
                    setTimeout(() => {
                        showMainInterface();
                        loadAllData();
                    }, 1000);
                } else {
                    showMessage('loginMessage', result.error || 'Senha incorreta.', 'error');
                }
            } catch (error) {
                console.error('Erro no login:', error);
                showMessage('loginMessage', 'Erro de conex√£o com o servidor.', 'error');
            } finally {
                loginBtn.disabled = false;
                loginBtn.innerHTML = 'Entrar';
            }
        });

        function logout() {
            localStorage.removeItem('authToken');
            authToken = null;
            showLogin();
        }

        async function loadAllData() {
            await Promise.all([
                loadStats(),
                loadChannels(),
                loadRoles(),
                loadTemplates(),
                loadCategories()
            ]);
        }

        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE}/stats`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const stats = await response.json();
                
                document.getElementById('statsAnnouncements').textContent = stats.totalAnnouncements || 0;
                document.getElementById('statsChannels').textContent = stats.channels || 0;
                document.getElementById('statsRoles').textContent = allRoles.length || 0;
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas:', error);
            }
        }

        async function loadChannels() {
            try {
                const response = await fetch(`${API_BASE}/channels`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();
                
                const channelSelect = document.getElementById('channelSelect');
                channelSelect.innerHTML = '<option value="">Selecione um canal</option>';
                
                Object.keys(data.channelsGrouped || {}).forEach(guildName => {
                    const optgroup = document.createElement('optgroup');
                    optgroup.label = guildName;
                    
                    data.channelsGrouped[guildName].forEach(channel => {
                        const option = document.createElement('option');
                        option.value = channel.id;
                        option.textContent = `#${channel.name} ${channel.category ? `(${channel.category})` : ''}`;
                        optgroup.appendChild(option);
                    });
                    
                    channelSelect.appendChild(optgroup);
                });
                
            } catch (error) {
                console.error('Erro ao carregar canais:', error);
                document.getElementById('channelSelect').innerHTML = '<option value="">Erro ao carregar canais</option>';
            }
        }

        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE}/categories`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
                
                const data = await response.json();
                const categories = data.categories || [];
                
                const categorySelect = document.getElementById('channelCategory');
                categorySelect.innerHTML = '<option value="">Sem categoria</option>';
                
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = `üìÅ ${category.name}`;
                    categorySelect.appendChild(option);
                });
                
            } catch (error) {
                console.error('Erro ao carregar categorias:', error);
                const categorySelect = document.getElementById('channelCategory');
                categorySelect.innerHTML = '<option value="">Erro ao carregar categorias</option>';
            }
        }

        async function refreshCategories() {
            showMessage('message', 'Atualizando categorias...', 'info');
            await loadCategories();
            showMessage('message', 'Categorias atualizadas com sucesso!', 'success');
        }

        function updateChannelPreview() {
            const channelNameInput = document.getElementById('channelName');
            const channelTypeSelect = document.getElementById('channelType');
            const channelPreview = document.getElementById('channelPreview');
            const formattedChannelName = document.getElementById('formattedChannelName');
            const channelTypeIcon = document.getElementById('channelTypeIcon');
            
            const rawName = channelNameInput.value.trim();
            
            if (rawName) {
                const formatted = rawName
                    .toLowerCase()
                    .replace(/\s+/g, '-')
                    .replace(/[^a-z0-9\-]/g, '')
                    .replace(/-+/g, '-')
                    .replace(/^-|-$/g, '');
                
                const channelType = channelTypeSelect.value;
                const icon = channelType === 'voice' ? 'üîä' : 'üí¨';
                const prefix = channelType === 'voice' ? '' : '#';
                
                channelTypeIcon.textContent = icon;
                formattedChannelName.textContent = `${prefix}${formatted}`;
                channelPreview.classList.add('show');
            } else {
                channelPreview.classList.remove('show');
            }
        }

        async function createChannel(e) {
            e.preventDefault();
            
            const channelName = document.getElementById('channelName').value;
            const channelType = document.getElementById('channelType').value;
            const channelCategory = document.getElementById('channelCategory').value;
            const createBtn = document.getElementById('createChannelBtn');
            
            if (!channelName.trim()) {
                showMessage('message', 'Nome do canal √© obrigat√≥rio.', 'error');
                return;
            }
            
            createBtn.disabled = true;
            createBtn.innerHTML = '<div class="loading-spinner"></div>Criando...';
            
            try {
                const response = await fetch(`${API_BASE}/create-channel`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: channelName.trim(),
                        type: channelType,
                        categoryId: channelCategory || null
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showMessage('message', `Canal "${channelName}" criado com sucesso! üéâ`, 'success');
                    document.getElementById('channelForm').reset();
                    
                    setTimeout(async () => {
                        await loadChannels();
                        showMessage('message', 'Lista de canais atualizada!', 'info');
                    }, 2000);
                    
                    loadStats();
                } else {
                    showMessage('message', result.error || 'Erro ao criar canal.', 'error');
                }
            } catch (error) {
                console.error('Erro ao criar canal:', error);
                showMessage('message', 'Erro de conex√£o com o servidor.', 'error');
            } finally {
                createBtn.disabled = false;
                createBtn.innerHTML = '‚ú® Criar Canal';
            }
        }

        async function loadRoles() {
            try {
                const response = await fetch(`${API_BASE}/roles`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (!response.ok) throw new Error(`Erro HTTP: ${response.status}`);
                
                const data = await response.json();
                allRoles = data.roles || [];
                renderRoles();
                
            } catch (error) {
                console.error('Erro ao carregar roles:', error);
                const rolesGrid = document.getElementById('rolesGrid');
                rolesGrid.innerHTML = `
                    <div class="role-item" style="grid-column: 1/-1; text-align: center; color: #666;">
                        <div style="margin-right: 8px;">‚ö†Ô∏è</div>
                        Erro ao carregar cargos. Verifique se o bot est√° online.
                    </div>
                `;
            }
        }

        function renderRoles() {
            const rolesGrid = document.getElementById('rolesGrid');
            
            if (!allRoles || allRoles.length === 0) {
                rolesGrid.innerHTML = `
                    <div class="role-item" style="grid-column: 1/-1; text-align: center; color: #666;">
                        <div style="margin-right: 8px;">‚ö†Ô∏è</div>
                        Nenhum cargo encontrado
                    </div>
                `;
                return;
            }
            
            rolesGrid.innerHTML = allRoles.map(role => {
                const roleColor = role.color ? `#${role.color.toString(16).padStart(6, '0')}` : '#99aab5';
                return `
                    <div class="role-item" data-role-id="${role.id}">
                        <div class="role-color" style="background-color: ${roleColor};"></div>
                        <div class="role-name">${escapeHtml(role.name)}</div>
                    </div>
                `;
            }).join('');
            
            document.querySelectorAll('.role-item').forEach(roleItem => {
                roleItem.addEventListener('click', function() {
                    const roleId = this.dataset.roleId;
                    if (!roleId) return;
                    
                    const index = selectedRoles.indexOf(roleId);
                    
                    if (index > -1) {
                        selectedRoles.splice(index, 1);
                        this.classList.remove('selected');
                    } else {
                        selectedRoles.push(roleId);
                        this.classList.add('selected');
                    }
                    
                    updateMentionsPreview();
                });
            });
        }

        function updateMentionsPreview() {
            const mentionsPreview = document.getElementById('mentionsPreview');
            const mentionTags = document.getElementById('mentionTags');
            
            if (selectedRoles.length === 0) {
                mentionsPreview.classList.remove('show');
                mentionTags.innerHTML = '';
                return;
            }
            
            mentionsPreview.classList.add('show');
            
            const selectedRoleNames = selectedRoles.map(roleId => {
                const role = allRoles.find(r => r.id === roleId);
                return role ? role.name : 'Cargo n√£o encontrado';
            });
            
            mentionTags.innerHTML = selectedRoleNames.map(name => 
                `<span class="mention-tag">@${escapeHtml(name)}</span>`
            ).join('');
        }

        async function loadTemplates() {
            try {
                const response = await fetch(`${API_BASE}/templates`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const templates = await response.json();
                updateTemplateSelect(templates);
            } catch (error) {
                console.error('Erro ao carregar templates:', error);
            }
        }

        function updateTemplateSelect(templates) {
            const templateSelect = document.getElementById('templateSelect');
            templateSelect.innerHTML = '<option value="">Selecione um template</option>';
            
            (templates || []).forEach(template => {
                const option = document.createElement('option');
                option.value = template.id;
                option.textContent = `${template.name} (${template.category})`;
                templateSelect.appendChild(option);
            });
        }

        function updateCharCounter() {
            const text = document.getElementById('announcementText').value;
            const counter = document.getElementById('charCounter');
            const length = text.length;
            
            counter.textContent = `${length}/2000 caracteres`;
            
            if (length > 1800) {
                counter.className = 'char-counter danger';
            } else if (length > 1500) {
                counter.className = 'char-counter warning';
            } else {
                counter.className = 'char-counter';
            }
        }

        function updateTemplateCharCounter() {
            const text = document.getElementById('templateContent').value;
            const counter = document.getElementById('templateCharCounter');
            const length = text.length;
            
            counter.textContent = `${length}/2000 caracteres`;
            
            if (length > 1800) {
                counter.className = 'char-counter danger';
            } else if (length > 1500) {
                counter.className = 'char-counter warning';
            } else {
                counter.className = 'char-counter';
            }
        }

        async function refreshChannels() {
            showMessage('message', 'Atualizando dados...', 'info');
            await Promise.all([loadChannels(), loadRoles(), loadCategories()]);
            showMessage('message', 'Dados atualizados com sucesso!', 'success');
        }

        function clearForm() {
            document.getElementById('announcementText').value = '';
            document.getElementById('templateSelect').value = '';
            document.getElementById('channelSelect').value = '';
            selectedRoles = [];
            selectedImage = null;
            document.getElementById('imagePreview').innerHTML = '';
            document.getElementById('imageInput').value = '';
            document.querySelectorAll('.role-item').forEach(item => item.classList.remove('selected'));
            document.querySelectorAll('.announcement-type').forEach(item => item.classList.remove('selected'));
            document.querySelector('.announcement-type[data-type="anuncio"]').classList.add('selected');
            selectedAnnouncementType = 'anuncio';
            updateCharCounter();
            updateMentionsPreview();
            showMessage('message', 'Formul√°rio limpo!', 'info');
        }

        function previewAnnouncement() {
            const content = document.getElementById('announcementText').value;
            const channelSelect = document.getElementById('channelSelect');
            const channelName = channelSelect.options[channelSelect.selectedIndex]?.text || 'Canal n√£o selecionado';
            
            if (!content.trim()) {
                showMessage('message', 'Digite uma mensagem para visualizar.', 'error');
                return;
            }

            const typeIcons = {
                'anuncio': 'üì¢',
                'novidade': '‚ú®',
                'atualizacao': 'üîÑ',
                'draft': 'üèÜ',
                'evento': 'üéâ',
                'vod': 'üìπ',
                'aviso': '‚ö†Ô∏è'
            };

            const typeNames = {
                'anuncio': 'An√∫ncio',
                'novidade': 'Novidade',
                'atualizacao': 'Atualiza√ß√£o',
                'draft': 'Inscri√ß√µes draft',
                'evento': 'Evento',
                'vod': 'VOD',
                'aviso': 'Aviso'
            };
            
            const mentionsText = selectedRoles.length > 0 ? 
                `<div style="margin-bottom: 10px; color: #5865f2; font-weight: bold;">
                    Cargos mencionados: ${selectedRoles.map(roleId => {
                        const role = allRoles.find(r => r.id === roleId);
                        return \`@\${role ? role.name : 'Cargo desconhecido'}\`;
                    }).join(', ')}
                </div>` : '';

            const imagePreview = selectedImage ? 
                `<div style="margin: 15px 0;">
                    <img src="\${URL.createObjectURL(selectedImage)}" style="max-width: 400px; max-height: 300px; border-radius: 8px;">
                </div>` : '';
            
            const previewWindow = window.open('', '_blank', 'width=700,height=600');
            previewWindow.document.write(`
                <html>
                <head>
                    <title>JOJO AN√öNCIOS - Visualiza√ß√£o</title>
                    <style>
                        body { 
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
                            background: #36393f; 
                            color: #dcddde; 
                            padding: 20px; 
                            margin: 0;
                        }
                        .embed {
                            background: #2f3136;
                            border-left: 4px solid #5865f2;
                            border-radius: 8px;
                            padding: 20px;
                            max-width: 600px;
                        }
                        .embed-title { 
                            color: #fff; 
                            font-weight: bold; 
                            margin-bottom: 15px; 
                            font-size: 20px;
                            display: flex;
                            align-items: center;
                            gap: 8px;
                        }
                        .embed-description { 
                            line-height: 1.6; 
                            white-space: pre-wrap; 
                            font-size: 16px;
                        }
                        .embed-footer { 
                            margin-top: 15px; 
                            font-size: 12px; 
                            color: #72767d; 
                            border-top: 1px solid #40444b;
                            padding-top: 10px;
                        }
                        .channel-info {
                            background: #40444b;
                            padding: 15px;
                            border-radius: 8px;
                            margin-bottom: 20px;
                            font-size: 14px;
                        }
                        .mentions-info {
                            background: rgba(88, 101, 242, 0.1);
                            border: 1px solid #5865f2;
                            padding: 10px;
                            border-radius: 6px;
                            margin-bottom: 15px;
                        }
                    </style>
                </head>
                <body>
                    <div class="channel-info">
                        <strong>üéØ JOJO AN√öNCIOS - PREVIEW</strong><br>
                        <strong>Canal:</strong> ${channelName}<br>
                        <strong>Tipo:</strong> ${typeNames[selectedAnnouncementType]}
                        ${selectedImage ? '<br><strong>Com imagem anexa</strong>' : ''}
                    </div>
                    ${mentionsText ? `<div class="mentions-info">${mentionsText}</div>` : ''}
                    <div class="embed">
                        <div class="embed-title">
                            ${typeIcons[selectedAnnouncementType]} ${typeNames[selectedAnnouncementType]}
                        </div>
                        <div class="embed-description">${content.replace(/\n/g, '<br>')}</div>
                        ${imagePreview}
                        <div class="embed-footer">
                            JOJO AN√öNCIOS ‚Ä¢ ${new Date().toLocaleString('pt-BR')}
                        </div>
                    </div>
                </body>
                </html>
            `);
        }

        async function sendAnnouncement(e) {
            e.preventDefault();
            
            const channelId = document.getElementById('channelSelect').value;
            const content = document.getElementById('announcementText').value;
            const templateId = document.getElementById('templateSelect').value;
            const sendBtn = document.getElementById('sendBtn');
            
            if (!channelId || !content.trim()) {
                showMessage('message', 'Preencha todos os campos obrigat√≥rios.', 'error');
                return;
            }
            
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<div class="loading-spinner"></div>Enviando...';
            
            try {
                const formData = new FormData();
                formData.append('channelId', channelId);
                formData.append('content', content);
                formData.append('templateId', templateId || '');
                formData.append('roles', JSON.stringify(selectedRoles));
                formData.append('type', selectedAnnouncementType);

                const selectedTypeEl = document.querySelector('.announcement-type.selected');
                if (selectedTypeEl) {
                    const iconEl = selectedTypeEl.querySelector('.announcement-type-icon');
                    const nameEl = selectedTypeEl.querySelector('.announcement-type-name');
                    formData.append('icon', iconEl ? iconEl.textContent.trim() : 'üì¢');
                    formData.append('typeName', nameEl ? nameEl.textContent.trim() : 'An√∫ncio');
                }

                if (selectedImage) {
                    formData.append('image', selectedImage);
                }
                
                const response = await fetch(`${API_BASE}/announcement`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` },
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showMessage('message', 'An√∫ncio enviado com sucesso! üéâ', 'success');
                    clearForm();
                    loadStats();
                } else {
                    showMessage('message', result.error || 'Erro ao enviar an√∫ncio.', 'error');
                }
            } catch (error) {
                console.error('Erro ao enviar an√∫ncio:', error);
                showMessage('message', 'Erro de conex√£o com o servidor.', 'error');
            } finally {
                sendBtn.disabled = false;
                sendBtn.innerHTML = 'üì§ Enviar An√∫ncio';
            }
        }

        async function saveTemplate(e) {
            e.preventDefault();
            
            const name = document.getElementById('templateName').value;
            const content = document.getElementById('templateContent').value;
            const category = document.getElementById('templateCategory').value;
            const saveBtn = document.getElementById('saveTemplateBtn');
            
            if (!name.trim() || !content.trim()) {
                showMessage('message', 'Preencha todos os campos do template.', 'error');
                return;
            }
            
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<div class="loading-spinner"></div>Salvando...';
            
            try {
                const response = await fetch(`${API_BASE}/template`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name, content, category })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showMessage('message', 'Template salvo com sucesso! üíæ', 'success');
                    document.getElementById('templateForm').reset();
                    updateTemplateCharCounter();
                    loadTemplates();
                } else {
                    showMessage('message', result.error || 'Erro ao salvar template.', 'error');
                }
            } catch (error) {
                console.error('Erro ao salvar template:', error);
                showMessage('message', 'Erro de conex√£o com o servidor.', 'error');
            } finally {
                saveBtn.disabled = false;
                saveBtn.innerHTML = 'üíæ Salvar';
            }
        }

        function showMessage(containerId, message, type) {
            const messageDiv = document.getElementById(containerId);
            const icons = { success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è' };
            
            messageDiv.innerHTML = `
                <div class="${type}">
                    ${icons[type] || ''} ${message}
                </div>
            `;
            
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }

        function escapeHtml(text) {
            if (!text) return '';
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.toString().replace(/[&<>"']/g, function(m) { return map[m]; });
        }

        // Atalhos de teclado
        document.addEventListener('keydown', function(e) {
            // Ctrl+Enter para enviar an√∫ncio
            if (e.ctrlKey && e.key === 'Enter') {
                const announcementText = document.getElementById('announcementText');
                if (document.activeElement === announcementText) {
                    document.getElementById('sendBtn').click();
                }
            }
            
            // Ctrl+L para limpar formul√°rio
            if (e.ctrlKey && e.key.toLowerCase() === 'l') {
                e.preventDefault();
                clearForm();
            }
            
            // Ctrl+P para preview
            if (e.ctrlKey && e.key.toLowerCase() === 'p') {
                e.preventDefault();
                previewAnnouncement();
            }
            
            // Ctrl+N para criar novo canal
            if (e.ctrlKey && e.key.toLowerCase() === 'n') {
                e.preventDefault();
                document.getElementById('channelName').focus();
            }
        });
    
// ==== TIPOS DE AN√öNCIOS CUSTOM ====
let customTypes = JSON.parse(localStorage.getItem('customTypes') || '[]');

function defaultTypes(){
    return [
        {icon:'üì¢',name:'An√∫ncio',id:'anuncio'},
        {icon:'‚ú®',name:'Novidade',id:'novidade'},
        {icon:'üîÑ',name:'Atualiza√ß√£o',id:'atualizacao'},
        {icon:'üéâ',name:'Evento',id:'evento'},
        {icon:'‚ö†Ô∏è',name:'Aviso',id:'aviso'}
    ];
}

function renderCustomTypes(){
    const grid=document.querySelector('.announcement-type-grid');
    if(!grid) return;
    // limpar
    grid.innerHTML='';
    [...defaultTypes(),...customTypes].forEach((t,i)=>{
        const div=document.createElement('div');
        div.className='announcement-type';
        div.dataset.type=t.id||t.name.toLowerCase();
        div.innerHTML=`<div class="announcement-type-icon">${t.icon}</div><div class="announcement-type-name">${t.name}</div>`;
        if(i>=defaultTypes().length){
            const del=document.createElement('button');
            del.textContent='üóëÔ∏è';
            del.style.marginTop='5px';
            del.onclick=(e)=>{e.stopPropagation();deleteType(i-defaultTypes().length);};
            div.appendChild(del);
        }
        div.addEventListener('click',function(){
            document.querySelectorAll('.announcement-type').forEach(el=>el.classList.remove('selected'));
            this.classList.add('selected');
            selectedAnnouncementType=this.dataset.type;
        });
        grid.appendChild(div);
    });
}

function addType(icon,name){
    customTypes.push({icon,name,id:name.toLowerCase()});
    localStorage.setItem('customTypes',JSON.stringify(customTypes));
    renderCustomTypes();
}
function deleteType(idx){
    customTypes.splice(idx,1);
    localStorage.setItem('customTypes',JSON.stringify(customTypes));
    renderCustomTypes();
}

// Form para criar tipo
document.addEventListener('DOMContentLoaded',()=>{
    const container=document.querySelector('.panel-section');
    if(container){
        const form=document.createElement('form');
        form.innerHTML=`
            <h3>‚ûï Novo Tipo</h3>
            <input type="text" id="newTypeIcon" placeholder="√çcone" maxlength="2" style="width:60px;padding:5px;">
            <input type="text" id="newTypeName" placeholder="Nome do Tipo" style="padding:5px;">
            <button type="submit" class="btn btn-small">Criar</button>
        `;
        form.addEventListener('submit',e=>{
            e.preventDefault();
            const icon=document.getElementById('newTypeIcon').value||'üì¢';
            const name=document.getElementById('newTypeName').value.trim();
            if(name){ addType(icon,name); form.reset(); }
        });
        container.appendChild(form);
        renderCustomTypes();
    }
});

</script>
</body>
</html>
